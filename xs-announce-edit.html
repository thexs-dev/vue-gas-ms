<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>Announce Edit</title>
  <script src="https://www.gstatic.com/firebasejs/6.2.3/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/6.2.3/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/6.2.3/firebase-auth.js"></script>
  <!-- <script src="https://cdn.jsdelivr.net/npm/vue"></script> -->
  <script src="https://cdn.jsdelivr.net/npm/vue@2.6.10/dist/vue.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/javascript-debounce@1.0.1/dist/javascript-debounce.js"></script>
</head>

<body>
  <div id="app">
    <textarea :value="content" @input="update" rows="23" style="width:100%; height:90%;"></textarea>
    <button @click="test">Test</button>
    <input type="number" v-model.lazy="key" type="number" min="1" style="width:45px;" @change="keychg">
    <span>⚠️️Careful!: On textarea changes (after 2s) it'd update FB content</span>
    <a :href="'https://thexs-mapping.firebaseio.com/announcements/' + key" target="_blank">(fb-entry)</a>
  </div>

  <script>

    var db = firebase.initializeApp({
      apiKey: "AIzaSyAhmPeDWnUsr49DzhrV3GXf-mA0OorYA4w",
      authDomain: "thexs-mapping.firebaseapp.com",
      databaseURL: 'https://thexs-mapping.firebaseio.com/'
    }).database();

    firebase.auth().signInWithPopup(new firebase.auth.GoogleAuthProvider())
      .then((result) => console.log(result))
      .catch((error) => console.log(error));

    var vm = new Vue({
      el: '#app',
      data() {
        return { key: 101, content: "" }
      },

      mounted() {
        this.getOnce();
      },

      methods: {
        update: debounce(function (e) {
          this.content = e.target.value;
          // console.log("debounced", this.key, this.content);
          db.ref("/announcements/" + this.key).update({ content: this.content });
        }, 2000),

        getOnce() {
          db.ref("/announcements/" + this.key).once('value')
            .then((snapshot) => {
              this.content = snapshot.val() ? snapshot.val().content : "";
            })
        },

        keychg() {
          // console.log(this.key);
          this.getOnce();
        },

        test() {
          console.log(this.key, this.content);
        }
      },
    })
  </script>
</body>

</html>